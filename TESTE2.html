<!DOCTYPE html>
<html>
<head>
    <script>
        function includeHTML(callback) {
            var z, i, elmnt, file, xhttp;
            z = document.getElementsByTagName("*");
            let total = 0;
            let loaded = 0;

            for (i = 0; i < z.length; i++) {
                elmnt = z[i];
                file = elmnt.getAttribute("w3-include-html");
                if (file) {
                    total++; // Contamos quantos arquivos serão carregados

                    xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function () {
                        if (this.readyState == 4) {
                            if (this.status == 200) {
                                elmnt.innerHTML = this.responseText;
                            }
                            if (this.status == 404) {
                                elmnt.innerHTML = "Dashboard4Skills não encontrado.";
                            }
                            elmnt.removeAttribute("w3-include-html");

                            loaded++; // Contamos os arquivos carregados

                            if (loaded === total && typeof callback === "function") {
                                callback(); // Executamos callback após todos os HTMLs serem carregados
                            }
                        }
                    };
                    xhttp.open("GET", file, true);
                    xhttp.send();
                }
            }
        }

        function recarregarScripts() {
            console.log("Recarregando scripts...");

            // Reexecuta os scripts do HTML carregado
            document.querySelectorAll("script").forEach(oldScript => {
                if (oldScript.src) {
                    let newScript = document.createElement("script");
                    newScript.src = oldScript.src;
                    newScript.async = false; // Garante que scripts externos sejam executados na ordem correta
                    document.body.appendChild(newScript);
                }
            });

            // Reaplicando eventos, se necessário
            document.querySelectorAll(".modal-trigger").forEach(el => {
                el.addEventListener("click", function () {
                    let target = document.querySelector(el.getAttribute("data-target"));
                    if (target) {
                        target.classList.add("show");
                    }
                });
            });
        }
    </script>
</head>
<body>
    <script src="https://apologialinux.github.io/script4.js"></script>

    <div w3-include-html="https://apologialinux.github.io/Dashboard4Skills.html"></div>

    <script>
        includeHTML(() => {
            console.log("HTML incluído!");
            recarregarScripts(); // Reexecuta os scripts após o carregamento do HTML
        });
    </script>
</body>
</html>
