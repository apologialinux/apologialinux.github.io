name: Deploy static site to GitHub Pages

on:
  push:
    branches:
      - main   # branch do seu repositório privado

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout código
        uses: actions/checkout@v3

      - name: Instalar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Instalar minificadores
        run: |
          npm install -g terser clean-css-cli html-minifier-terser

      - name: Minificar arquivos
        run: |
          mkdir -p site
          # Minificar HTML
          for file in *.html; do
            html-minifier-terser --collapse-whitespace --remove-comments --minify-css true --minify-js true "$file" -o "site/$file"
          done
          # Minificar CSS
          for file in *.css; do
            cleancss -o "site/$file" "$file"
          done
          # Minificar JS
          for file in *.js; do
            terser "$file" -o "site/$file" --compress --mangle
          done
          # Copiar JSON sem minificação
          cp -r *.json site/ || true

      - name: Deploy para apologialinux.github.io
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.PERSONAL_TOKEN }}
          publish_dir: ./site
          external_repository: apologialinux/apologialinux.github.io
          publish_branch: main
