name: Deploy static site to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v3

      - name: Instalar minificadores
        run: |
          npm install -g terser clean-css-cli html-minifier-terser

      - name: Minificar arquivos
        run: |
          mkdir -p site
          # Minificar JS
          for file in $(find . -name "*.js"); do
            terser "$file" -o "site/$file" --compress --mangle
          done
          # Minificar CSS
          for file in $(find . -name "*.css"); do
            cleancss -o "site/$file" "$file"
          done
          # Minificar HTML
          for file in $(find . -name "*.html"); do
            html-minifier-terser --collapse-whitespace --remove-comments --minify-css true --minify-js true -o "site/$file" "$file"
          done

      - name: Deploy para apologialinux.github.io
        uses: peaceiris/actions-gh-pages@v3
        with:
          personal_token: ${{ secrets.PERSONAL_TOKEN }}
          publish_dir: ./site
          external_repository: apologialinux/apologialinux.github.io
          publish_branch: main
